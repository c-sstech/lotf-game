<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lord of the Flies: Plot Sequencer</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jost:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Jost', sans-serif;
            background-color: #f0fdf4; /* Light green bg */
            background-image: radial-gradient(#dcfce7 2px, transparent 2px);
            background-size: 24px 24px;
        }

        .drag-source-item {
            cursor: grab;
            transition: all 0.2s;
        }
        .drag-source-item:active {
            cursor: grabbing;
        }
        
        .slot-item {
            transition: all 0.2s;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .droppable-hover {
            background-color: #f0fdf4;
            border-color: #16a34a;
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // The canonical correct order of events for Ch 1 & 2
        const CORRECT_SEQUENCE = [
            { id: 1, text: "Ralph and Piggy find the conch shell in the lagoon." },
            { id: 2, text: "Ralph blows the conch to summon the other boys." },
            { id: 3, text: "The boys vote for a chief; Ralph is elected over Jack." },
            { id: 4, text: "Ralph, Jack, and Simon explore the mountain and find a piglet caught in vines." },
            { id: 5, text: "Jack hesitates and fails to kill the piglet, promising 'next time'." },
            { id: 6, text: "At an assembly, a small boy with a birthmark mentions a 'beastie'." },
            { id: 7, text: "The boys use Piggy's glasses to light a rescue fire on the mountain." },
            { id: 8, text: "The fire burns out of control, and the boy with the birthmark goes missing." }
        ];

        function App() {
            const [gameState, setGameState] = useState('intro'); // intro, playing, results
            const [studentName, setStudentName] = useState('');
            const [score, setScore] = useState(0);
            
            // State for the lists
            const [sourceItems, setSourceItems] = useState([]);
            const [slots, setSlots] = useState([]); // Array of size 8, containing items or null

            // Drag State
            const [draggedData, setDraggedData] = useState(null); // { type: 'source'|'slot', index: number, item: object }
            const [dragOverSlotIndex, setDragOverSlotIndex] = useState(null);

            // Initialize game
            const startGame = () => {
                if(!studentName.trim()) {
                    alert("Please enter your name to start.");
                    return;
                }
                // Shuffle items for source list
                const shuffled = [...CORRECT_SEQUENCE]
                    .map(value => ({ value, sort: Math.random() }))
                    .sort((a, b) => a.sort - b.sort)
                    .map(({ value }) => value);
                
                setSourceItems(shuffled);
                setSlots(Array(CORRECT_SEQUENCE.length).fill(null));
                setGameState('playing');
            };

            // --- Drag Handlers ---

            const handleDragStart = (e, type, index, item) => {
                setDraggedData({ type, index, item });
                e.dataTransfer.effectAllowed = "move";
                e.dataTransfer.setData("text/plain", JSON.stringify({ type, index })); // mostly for Firefox compat
            };

            const handleDragOver = (e, index) => {
                e.preventDefault(); // Necessary to allow dropping
                setDragOverSlotIndex(index);
            };
            
            const handleDragLeave = (e) => {
                // simple check to prevent flickering if leaving for a child element
                // usually we'd check relatedTarget but for this simple UI, resetting on drop is safer
            };

            const handleDropOnSlot = (e, targetSlotIndex) => {
                e.preventDefault();
                setDragOverSlotIndex(null);

                if (!draggedData) return;

                const newSlots = [...slots];
                const newSourceItems = [...sourceItems];
                const itemToMove = draggedData.item;

                // Logic 1: Dragging from Source to Slot
                if (draggedData.type === 'source') {
                    // Remove from source
                    newSourceItems.splice(draggedData.index, 1);
                    
                    // If slot is occupied, move that occupant back to source
                    if (newSlots[targetSlotIndex] !== null) {
                        newSourceItems.push(newSlots[targetSlotIndex]);
                    }

                    // Place item in slot
                    newSlots[targetSlotIndex] = itemToMove;
                }
                // Logic 2: Dragging from Slot to Slot (Reordering timeline)
                else if (draggedData.type === 'slot') {
                    const originalSlotItem = newSlots[targetSlotIndex];
                    
                    // Swap
                    newSlots[targetSlotIndex] = itemToMove;
                    newSlots[draggedData.index] = originalSlotItem;
                }

                setSlots(newSlots);
                setSourceItems(newSourceItems);
                setDraggedData(null);
            };

            // Allow dropping back to source (to remove from timeline)
            const handleDropOnSource = (e) => {
                e.preventDefault();
                if (!draggedData || draggedData.type === 'source') return;

                const newSlots = [...slots];
                const newSourceItems = [...sourceItems];

                // Remove from slot
                newSlots[draggedData.index] = null;
                // Add to source
                newSourceItems.push(draggedData.item);

                setSlots(newSlots);
                setSourceItems(newSourceItems);
                setDraggedData(null);
            };

            // --- Mobile / Click Helpers ---
            const moveToSource = (slotIndex) => {
                if (!slots[slotIndex]) return;
                const newSlots = [...slots];
                const newSourceItems = [...sourceItems];
                
                newSourceItems.push(newSlots[slotIndex]);
                newSlots[slotIndex] = null;
                
                setSlots(newSlots);
                setSourceItems(newSourceItems);
            };

            const moveToFirstEmptySlot = (sourceIndex) => {
                const firstEmptyIndex = slots.findIndex(s => s === null);
                if (firstEmptyIndex === -1) return; // Full

                const newSlots = [...slots];
                const newSourceItems = [...sourceItems];
                
                newSlots[firstEmptyIndex] = newSourceItems[sourceIndex];
                newSourceItems.splice(sourceIndex, 1);

                setSlots(newSlots);
                setSourceItems(newSourceItems);
            };


            // --- Check Answers ---
            const checkAnswers = () => {
                let currentScore = 0;
                let filledCount = 0;
                
                slots.forEach((item, index) => {
                    if (item) {
                        filledCount++;
                        if (item.id === CORRECT_SEQUENCE[index].id) {
                            currentScore++;
                        }
                    }
                });

                if (filledCount < CORRECT_SEQUENCE.length) {
                    if(!confirm(`You have only filled ${filledCount} of ${CORRECT_SEQUENCE.length} slots. Are you sure you want to submit?`)) {
                        return;
                    }
                }

                setScore(currentScore);
                setGameState('results');
            };

            const resetGame = () => {
                setGameState('intro');
                setScore(0);
                setSourceItems([]);
                setSlots([]);
                setStudentName('');
            };


            /* --- VIEW COMPONENTS --- */

            if (gameState === 'intro') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="bg-white max-w-lg w-full rounded-2xl shadow-xl overflow-hidden border-2 border-green-800">
                            <div className="bg-green-800 p-8 text-center text-white relative overflow-hidden">
                                <i className="ph ph-plant absolute top-[-20px] left-[-20px] text-8xl opacity-10"></i>
                                <i className="ph ph-fire absolute bottom-[-20px] right-[-20px] text-8xl opacity-10"></i>
                                <h1 className="text-3xl font-extrabold mb-2 uppercase tracking-widest">The Island</h1>
                                <p className="opacity-90 font-medium">Plot Sequencer: Chapters 1 & 2</p>
                            </div>
                            <div className="p-8 space-y-6">
                                <div className="space-y-2 text-gray-600 text-center">
                                    <p>Reconstruct the timeline.</p>
                                    <p className="text-sm">Drag events from the bank to the timeline in the correct order.</p>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">Student Name</label>
                                    <input 
                                        type="text" 
                                        value={studentName}
                                        onChange={(e) => setStudentName(e.target.value)}
                                        placeholder="Enter your name..."
                                        className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition-all"
                                    />
                                </div>

                                <button 
                                    onClick={startGame}
                                    className="w-full bg-green-700 hover:bg-green-800 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-95 transition-all flex items-center justify-center gap-2"
                                >
                                    Start Assignment <i className="ph ph-arrow-right font-bold"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'playing') {
                return (
                    <div className="min-h-screen p-4 md:p-8 max-w-7xl mx-auto flex flex-col h-screen">
                        {/* Header */}
                        <div className="flex justify-between items-center mb-4 bg-white p-4 rounded-xl shadow-sm border border-green-100 flex-shrink-0">
                            <div>
                                <h2 className="font-bold text-gray-800 text-lg">Plot Sequencer</h2>
                                <p className="text-sm text-gray-500">{studentName}</p>
                            </div>
                            <button 
                                onClick={checkAnswers}
                                className="bg-black text-white font-bold py-2 px-6 rounded-lg shadow hover:bg-gray-800 transition-colors flex items-center gap-2"
                            >
                                <i className="ph ph-check-circle text-lg"></i> Submit
                            </button>
                        </div>

                        {/* Game Area */}
                        <div className="flex flex-col md:flex-row gap-6 flex-1 min-h-0">
                            
                            {/* Left: Source Bank */}
                            <div 
                                className="flex-1 bg-white rounded-xl shadow-sm border border-green-100 flex flex-col min-h-0"
                                onDragOver={(e) => e.preventDefault()}
                                onDrop={handleDropOnSource}
                            >
                                <div className="p-4 border-b border-gray-100 bg-gray-50 rounded-t-xl">
                                    <h3 className="font-bold text-gray-700 flex items-center gap-2">
                                        <i className="ph ph-list-dashes"></i> Event Bank
                                    </h3>
                                    <p className="text-xs text-gray-500 mt-1">Drag items to the timeline on the right</p>
                                </div>
                                <div className="p-4 overflow-y-auto flex-1 space-y-3 custom-scrollbar">
                                    {sourceItems.length === 0 && (
                                        <div className="text-center text-gray-400 py-10 italic">
                                            All events placed!
                                        </div>
                                    )}
                                    {sourceItems.map((item, index) => (
                                        <div 
                                            key={item.id}
                                            draggable
                                            onDragStart={(e) => handleDragStart(e, 'source', index, item)}
                                            onClick={() => moveToFirstEmptySlot(index)}
                                            className="drag-source-item bg-white border border-gray-200 p-3 rounded-lg shadow-sm hover:shadow-md hover:border-green-400 active:scale-95 cursor-pointer"
                                        >
                                            <p className="text-sm text-gray-800">{item.text}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Right: Timeline Slots */}
                            <div className="flex-1 bg-green-50 rounded-xl border-2 border-green-100/50 flex flex-col min-h-0">
                                <div className="p-4 border-b border-green-100 bg-green-100/50 rounded-t-xl">
                                    <h3 className="font-bold text-green-800 flex items-center gap-2">
                                        <i className="ph ph-clock-clockwise"></i> Timeline
                                    </h3>
                                    <p className="text-xs text-green-700 mt-1">Order events chronologically (1-8)</p>
                                </div>
                                <div className="p-4 overflow-y-auto flex-1 space-y-3 custom-scrollbar">
                                    {slots.map((slotItem, index) => (
                                        <div 
                                            key={index}
                                            onDragOver={(e) => handleDragOver(e, index)}
                                            onDrop={(e) => handleDropOnSlot(e, index)}
                                            className={`
                                                relative flex items-stretch min-h-[80px] rounded-lg border-2 transition-all duration-200
                                                ${dragOverSlotIndex === index 
                                                    ? 'border-green-500 bg-green-100 scale-[1.02] shadow-lg z-10' 
                                                    : slotItem 
                                                        ? 'border-green-200 bg-white shadow-sm' 
                                                        : 'border-dashed border-green-300 bg-green-50/50'
                                                }
                                            `}
                                        >
                                            {/* Number Indicator */}
                                            <div className="w-10 flex-shrink-0 flex items-center justify-center border-r border-gray-100/50 bg-black/5 text-gray-500 font-bold font-mono">
                                                {index + 1}
                                            </div>

                                            {/* Slot Content */}
                                            <div className="flex-1 p-3 flex items-center justify-center text-center">
                                                {slotItem ? (
                                                    <div 
                                                        draggable
                                                        onDragStart={(e) => handleDragStart(e, 'slot', index, slotItem)}
                                                        onClick={() => moveToSource(index)}
                                                        className="w-full h-full flex items-center text-left cursor-grab active:cursor-grabbing group"
                                                    >
                                                        <span className="text-sm text-gray-800 font-medium">{slotItem.text}</span>
                                                        <i className="ph ph-x-circle text-gray-300 group-hover:text-red-400 ml-auto pl-2 text-xl transition-colors" title="Remove"></i>
                                                    </div>
                                                ) : (
                                                    <span className="text-xs text-green-400 font-medium uppercase tracking-wider select-none">
                                                        Drop Event Here
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                        </div>
                    </div>
                );
            }

            if (gameState === 'results') {
                const percentage = Math.round((score / CORRECT_SEQUENCE.length) * 100);
                const isPassing = percentage >= 70;

                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="bg-white max-w-2xl w-full rounded-2xl shadow-xl overflow-hidden border-2 border-gray-100">
                            
                            {/* Header */}
                            <div className={`${isPassing ? 'bg-green-600' : 'bg-orange-600'} text-white p-8 text-center`}>
                                <h2 className="text-4xl font-extrabold mb-1">{percentage}%</h2>
                                <p className="opacity-90 font-medium uppercase tracking-wide">
                                    {isPassing ? 'Well Done!' : 'Keep Reading!'}
                                </p>
                            </div>

                            <div className="p-8">
                                <div className="flex justify-between items-center mb-6 border-b border-gray-100 pb-4">
                                    <div>
                                        <label className="text-xs uppercase text-gray-500 font-bold">Student</label>
                                        <p className="font-bold text-lg">{studentName}</p>
                                    </div>
                                    <div className="text-right">
                                        <label className="text-xs uppercase text-gray-500 font-bold">Score</label>
                                        <p className="font-bold text-lg">{score} / {CORRECT_SEQUENCE.length}</p>
                                    </div>
                                </div>

                                <h3 className="text-sm font-bold text-gray-500 uppercase mb-4">Results Details</h3>
                                
                                <div className="space-y-3 mb-8 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                                    {slots.map((item, index) => {
                                        // If slot was empty
                                        if (!item) return (
                                            <div key={index} className="flex gap-3 p-3 rounded-lg text-sm bg-gray-50 border border-gray-200 opacity-70">
                                                <div className="mt-0.5 min-w-[20px] text-gray-400">
                                                    <i className="ph ph-minus-circle text-lg"></i>
                                                </div>
                                                <div>
                                                    <span className="font-bold block text-gray-500">Position {index + 1}: Empty</span>
                                                    <span className="text-xs text-gray-400 italic">Correct answer: "{CORRECT_SEQUENCE[index].text.substring(0, 30)}..."</span>
                                                </div>
                                            </div>
                                        );

                                        const isCorrect = item.id === CORRECT_SEQUENCE[index].id;
                                        return (
                                            <div key={item.id} className={`flex gap-3 p-3 rounded-lg text-sm ${isCorrect ? 'bg-green-50 border border-green-100' : 'bg-red-50 border border-red-100'}`}>
                                                <div className={`mt-0.5 min-w-[20px] ${isCorrect ? 'text-green-600' : 'text-red-500'}`}>
                                                    {isCorrect ? <i className="ph ph-check-circle-fill text-lg"></i> : <i className="ph ph-x-circle-fill text-lg"></i>}
                                                </div>
                                                <div>
                                                    <span className="font-bold block text-gray-900">
                                                        Position {index + 1}: {isCorrect ? 'Correct' : 'Incorrect'}
                                                    </span>
                                                    <span className="text-gray-600">{item.text}</span>
                                                    {!isCorrect && (
                                                        <div className="mt-1 text-xs text-red-600 font-medium">
                                                            Should be: "{CORRECT_SEQUENCE[index].text.substring(0, 30)}..."
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>

                                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 text-center mb-6">
                                    <p className="text-sm text-gray-600 font-medium">
                                        <i className="ph ph-camera mr-1"></i> 
                                        Take a screenshot of this page to submit.
                                    </p>
                                </div>

                                <button 
                                    onClick={resetGame}
                                    className="w-full border-2 border-gray-200 text-gray-600 font-bold py-3 rounded-xl hover:bg-gray-50 transition-colors"
                                >
                                    Try Again
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>